<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adoptar | Patitas Felices</title>
    <link rel="stylesheet" href="css/estilos.css" />
</head>
<body>
    <nav class="navegacion">
        <div class="contenedor">
            <div class="logo">
                <img src="assets/images/logo.png" alt="Patitas Felices" />
                <span class="logo-texto">Patitas Felices</span>
            </div>
            <div class="enlaces-nav">
                <a href="index.html" class="enlace">Inicio</a>
                <a href="adoptar.html" class="enlace activo">Adoptar</a>
                <a href="donadores.html" class="enlace">Donadores</a>
                <a href="nosotros.html" class="enlace">Nosotros</a>
                <button onclick="cerrarSesion()" class="btn btn-outline" id="btnCerrarSesion">Cerrar Sesión</button>
            </div>
        </div>
    </nav>

    <main>
        <section class="encabezado-pagina">
            <div class="contenedor">
                <h1>Bienvenido, <span id="nombreUsuario">Usuario</span></h1>
                <p>Estos son los usuarios autorizados en el sistema</p>
            </div>
        </section>

        <section class="seccion">
            <div class="contenedor">
                <h2>Usuarios registrados en Firebase</h2>
                <table class="tabla-simple" id="tablaUsuarios">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Nombre</th>
                            <th>Rol</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoTabla">
                        <tr><td colspan="3">Cargando usuarios...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Tus archivos JS -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    
    <script>
        // Verificar autenticación
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            // Obtener datos del usuario
            const userDoc = await db.collection('usuarios').doc(user.uid).get();
            const userData = userDoc.data();
            
            // Mostrar nombre
            document.getElementById('nombreUsuario').textContent = userData.nombre || 'Usuario';
            
            // Cargar lista de usuarios
            cargarUsuarios();
        });
        
        async function cargarUsuarios() {
            const snapshot = await db.collection('usuarios').get();
            const usuarios = [];
            snapshot.forEach(doc => usuarios.push(doc.data()));
            
            const tbody = document.getElementById('cuerpoTabla');
            tbody.innerHTML = usuarios.map(u => `
                <tr>
                    <td>${u.email}</td>
                    <td>${u.nombre || '—'}</td>
                    <td>
                        <span class="badge ${u.esAdmin ? 'badge-admin' : 'badge-user'}">
                            ${u.esAdmin ? 'Administrador' : 'Adoptante'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>